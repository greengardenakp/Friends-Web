<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FriendsConnect - Social Media Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-light: #1877f2;
            --primary-dark: #166fe5;
            --secondary: #42b72a;
            --accent: #f02849;
            --warning: #f7b928;
            --success: #36a420;
            --light: #f0f2f5;
            --dark: #1c1e21;
            --gray: #65676b;
            --light-gray: #e4e6eb;
            
            /* Theme Variables */
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #1c1e21;
            --border-color: #ddd;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 2px 12px rgba(0, 0, 0, 0.1);
            
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg-color: #18191a;
            --card-bg: #242526;
            --text-color: #e4e6eb;
            --border-color: #3e4042;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 2px 12px rgba(0, 0, 0, 0.3);
        }

        [data-theme="blue"] {
            --primary-light: #1877f2;
            --primary-dark: #166fe5;
            --bg-color: #eef2ff;
            --card-bg: #ffffff;
        }

        [data-theme="purple"] {
            --primary-light: #8a2be2;
            --primary-dark: #7b1fa2;
            --bg-color: #f3e5f5;
            --card-bg: #ffffff;
        }

        [data-theme="gold"] {
            --primary-light: #ffd700;
            --primary-dark: #daa520;
            --bg-color: #fffaf0;
            --card-bg: #ffffff;
        }

        .glassmorphism {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .glassmorphism {
            background: rgba(36, 37, 38, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease;
        }

        .animate-slide-in {
            animation: slideIn 0.3s ease;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        /* Header */
        .header {
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: var(--transition);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-light);
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .logo span {
            background: linear-gradient(45deg, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 45px 12px 16px;
            border: none;
            background-color: var(--bg-color);
            border-radius: 50px;
            font-size: 15px;
            color: var(--text-color);
            transition: var(--transition);
        }

        .search-bar input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        .nav-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            text-decoration: none;
            position: relative;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-icon:hover {
            background-color: var(--light-gray);
            transform: translateY(-2px);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--card-bg);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            position: relative;
        }

        .user-menu:hover {
            background-color: var(--bg-color);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-light), var(--secondary));
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .online-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            background-color: var(--success);
            border-radius: 50%;
            border: 2px solid var(--card-bg);
        }

        .online-dot.away {
            background-color: var(--warning);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 20px;
            padding: 80px 0 20px;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 80px;
            height: calc(100vh - 100px);
            overflow-y: auto;
            padding-right: 10px;
        }

        .sidebar-section {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .sidebar-section:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .sidebar-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Menu Items */
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--border-radius);
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
            margin-bottom: 4px;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
            font-size: 14px;
        }

        .menu-item:hover {
            background-color: var(--bg-color);
        }

        .menu-item.active {
            background-color: var(--bg-color);
            color: var(--primary-light);
            font-weight: 500;
        }

        .menu-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            transition: var(--transition);
        }

        .menu-item.active .menu-icon {
            background-color: var(--primary-light);
            color: white;
        }

        /* Story Circle */
        .story-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--primary-light);
            padding: 2px;
            cursor: pointer;
            transition: var(--transition);
        }

        .story-circle:hover {
            transform: scale(1.05);
        }

        .story-circle img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .add-story {
            border: 2px dashed var(--gray);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray);
        }

        .add-story i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Create Post */
        .create-post {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .post-input {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .post-input input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background-color: var(--bg-color);
            border-radius: 50px;
            font-size: 15px;
            color: var(--text-color);
            transition: var(--transition);
        }

        .post-input input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        .post-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            border-top: 1px solid var(--border-color);
            padding-top: 16px;
        }

        .post-action {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            border-radius: var(--border-radius);
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            font-size: 14px;
        }

        .post-action:hover {
            background-color: var(--bg-color);
            transform: translateY(-2px);
        }

        /* Post Card */
        .post-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
            transition: var(--transition);
        }

        .post-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .post-author-info {
            flex: 1;
        }

        .post-author-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 2px;
        }

        .post-meta {
            font-size: 13px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-content {
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .post-media {
            width: 100%;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 16px;
        }

        .post-media img, .post-media video {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
            border-radius: var(--border-radius);
        }

        .post-stats {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--gray);
            font-size: 14px;
        }

        .post-actions-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            padding: 8px 0;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px;
            border-radius: var(--border-radius);
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            background: none;
            font-family: inherit;
            font-size: 14px;
        }

        .post-action-btn:hover {
            background-color: var(--bg-color);
        }

        .post-action-btn.active {
            color: var(--primary-light);
        }

        /* Comments */
        .comments-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .comment-input {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .comment-input input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background-color: var(--bg-color);
            border-radius: 50px;
            font-size: 14px;
            color: var(--text-color);
        }

        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
        }

        /* Right Sidebar */
        .right-sidebar {
            position: sticky;
            top: 80px;
            height: calc(100vh - 100px);
            overflow-y: auto;
            padding-left: 10px;
        }

        /* Friend Suggestions */
        .friend-suggestion {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            margin-bottom: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .friend-suggestion:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .friend-mutual {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .friend-actions {
            display: flex;
            gap: 8px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-primary {
            background-color: var(--primary-light);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .btn-secondary {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: var(--light-gray);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #2d8c1b;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--accent);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d11a3a;
            transform: translateY(-2px);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.3s ease;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: var(--transition);
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.1);
        }

        /* Chat Interface */
        .chat-container {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
        }

        .message.sent {
            background-color: var(--primary-light);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message.received {
            background-color: var(--bg-color);
            color: var(--text-color);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .chat-input {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
        }

        /* Birthday Animation */
        .birthday-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .birthday-cake {
            font-size: 100px;
            animation: float 3s ease-in-out infinite;
            color: #ffd700;
        }

        .birthday-text {
            color: white;
            font-size: 32px;
            font-weight: bold;
            margin-top: 20px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        /* Marketplace */
        .marketplace-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .marketplace-item {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .marketplace-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .marketplace-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .marketplace-info {
            padding: 16px;
        }

        /* Digital ID Card */
        .id-card {
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            border-radius: var(--border-radius);
            padding: 30px;
            color: white;
            text-align: center;
            box-shadow: var(--shadow-lg);
            max-width: 400px;
            margin: 0 auto;
        }

        .id-card h2 {
            margin-bottom: 20px;
            font-size: 24px;
        }

        .id-card .qr-code {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            background-color: white;
            padding: 10px;
            border-radius: 8px;
        }

        /* Theme Switcher */
        .theme-switcher {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-light);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }

        .theme-btn:hover {
            transform: scale(1.1) rotate(30deg);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid var(--bg-color);
            border-radius: 50%;
            border-top-color: var(--primary-light);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar, .right-sidebar {
                display: none;
            }
            
            .nav-icons {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background-color: var(--card-bg);
            z-index: 2000;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            overflow-y: auto;
        }

        .mobile-menu.active {
            left: 0;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: inline-block;
            padding: 8px 16px;
            background-color: var(--bg-color);
            border-radius: 18px;
            font-size: 12px;
            color: var(--gray);
        }

        .typing-dots {
            display: inline-block;
        }

        .typing-dots span {
            display: inline-block;
            width: 4px;
            height: 4px;
            margin: 0 1px;
            background-color: var(--gray);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header glassmorphism">
        <div class="container">
            <div class="header-content">
                <!-- Logo -->
                <a href="#" class="logo">
                    <i class="fas fa-user-friends"></i>
                    <span>FriendsConnect</span>
                </a>

                <!-- Search -->
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search friends, posts, or groups...">
                    <button class="btn btn-primary btn-sm" id="searchBtn" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); padding: 8px 12px;">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <!-- Navigation Icons -->
                <div class="nav-icons">
                    <div class="nav-icon" id="homeBtn" title="Home">
                        <i class="fas fa-home"></i>
                        <span class="notification-badge" id="homeBadge">3</span>
                    </div>
                    <div class="nav-icon" id="friendsBtn" title="Friends">
                        <i class="fas fa-user-friends"></i>
                        <span class="notification-badge" id="friendBadge">5</span>
                    </div>
                    <div class="nav-icon" id="messagesBtn" title="Messages">
                        <i class="fas fa-comments"></i>
                        <span class="notification-badge" id="messageBadge">12</span>
                    </div>
                    <div class="nav-icon" id="notificationsBtn" title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge">8</span>
                    </div>
                </div>

                <!-- User Menu -->
                <div class="user-menu" id="userMenu">
                    <div class="user-avatar" id="userAvatar">
                        <img id="avatarImg" src="" alt="Avatar">
                        <div class="online-dot" id="onlineStatus"></div>
                    </div>
                    <span id="userName">Loading...</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="main-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar">
                <!-- User Profile -->
                <div class="sidebar-section">
                    <div class="user-info">
                        <div class="user-avatar" style="width: 80px; height: 80px; margin: 0 auto 16px;">
                            <img id="sidebarAvatar" src="" alt="Avatar">
                            <div class="online-dot" id="sidebarOnlineStatus"></div>
                        </div>
                        <h3 style="text-align: center; margin-bottom: 8px;" id="sidebarName">Loading...</h3>
                        <p style="text-align: center; color: var(--gray); font-size: 14px;" id="sidebarBio">Loading...</p>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 12px;" id="viewProfileBtn">
                            <i class="fas fa-user"></i> View Profile
                        </button>
                    </div>
                </div>

                <!-- Menu -->
                <div class="sidebar-section">
                    <nav>
                        <button class="menu-item active" id="newsFeedBtn">
                            <div class="menu-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <span>News Feed</span>
                        </button>
                        <button class="menu-item" id="messengerBtn">
                            <div class="menu-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <span>Messenger</span>
                            <span class="notification-badge">12</span>
                        </button>
                        <button class="menu-item" id="friendsBtn">
                            <div class="menu-icon">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <span>Friends</span>
                            <span class="notification-badge">5</span>
                        </button>
                        <button class="menu-item" id="groupsBtn">
                            <div class="menu-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <span>Groups</span>
                        </button>
                        <button class="menu-item" id="marketplaceBtn">
                            <div class="menu-icon">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <span>Marketplace</span>
                        </button>
                        <button class="menu-item" id="storiesBtn">
                            <div class="menu-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <span>Stories</span>
                        </button>
                        <button class="menu-item" id="eventsBtn">
                            <div class="menu-icon">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <span>Events</span>
                        </button>
                        <button class="menu-item" id="digitalIdBtn">
                            <div class="menu-icon">
                                <i class="fas fa-id-card"></i>
                            </div>
                            <span>Digital ID</span>
                        </button>
                    </nav>
                </div>

                <!-- Birthday Section -->
                <div class="sidebar-section" id="birthdaysSection" style="display: none;">
                    <h3 class="sidebar-title">
                        <i class="fas fa-birthday-cake"></i> Birthdays
                    </h3>
                    <div id="birthdaysList">
                        <!-- Birthdays will be loaded here -->
                    </div>
                </div>

                <!-- Friend Suggestions -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-user-plus"></i> Friend Suggestions
                        <small style="font-size: 12px; color: var(--gray);">AI-Powered</small>
                    </h3>
                    <div id="friendSuggestions">
                        <!-- Suggestions will be loaded here -->
                    </div>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 12px;" id="viewAllSuggestionsBtn">
                        View All Suggestions
                    </button>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Create Post Section -->
                <div class="create-post" id="createPostSection">
                    <div class="post-input">
                        <div class="user-avatar" id="postAvatar">
                            <img src="" alt="Avatar">
                        </div>
                        <input type="text" id="postContent" placeholder="What's on your mind?">
                    </div>
                    <div class="post-actions">
                        <div class="post-action" id="addPhotoBtn">
                            <i class="fas fa-image" style="color: #45bd62;"></i>
                            <span>Photo/Video</span>
                        </div>
                        <div class="post-action" id="tagFriendsBtn">
                            <i class="fas fa-user-tag" style="color: #1877f2;"></i>
                            <span>Tag Friends</span>
                        </div>
                        <div class="post-action" id="addFeelingBtn">
                            <i class="fas fa-smile" style="color: #f7b928;"></i>
                            <span>Feeling</span>
                        </div>
                        <button class="btn btn-primary" id="postBtn">
                            <i class="fas fa-paper-plane"></i> Post
                        </button>
                    </div>
                </div>

                <!-- Stories Section -->
                <div class="sidebar-section" id="storiesSection">
                    <h3 class="sidebar-title">Stories</h3>
                    <div style="display: flex; gap: 15px; overflow-x: auto; padding: 10px 0;">
                        <div class="story-circle add-story" id="addStoryBtn">
                            <i class="fas fa-plus"></i>
                            <small style="font-size: 10px;">Add Story</small>
                        </div>
                        <!-- Stories will be loaded here -->
                    </div>
                </div>

                <!-- Posts Feed -->
                <div id="postsFeed">
                    <!-- Posts will be loaded here -->
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <!-- Online Friends -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-circle" style="color: var(--success); font-size: 10px;"></i>
                        Online Friends
                    </h3>
                    <div id="onlineFriendsList">
                        <!-- Online friends will be loaded here -->
                    </div>
                </div>

                <!-- Trending Posts -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-fire" style="color: var(--warning);"></i>
                        Trending Now
                    </h3>
                    <div id="trendingPosts">
                        <!-- Trending posts will be loaded here -->
                    </div>
                </div>

                <!-- Marketplace -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-shopping-bag"></i>
                        Marketplace
                    </h3>
                    <div id="marketplaceItems">
                        <!-- Marketplace items will be loaded here -->
                    </div>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 12px;" id="viewMarketplaceBtn">
                        Browse Marketplace
                    </button>
                </div>

                <!-- Groups You Might Like -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-users"></i>
                        Suggested Groups
                    </h3>
                    <div id="suggestedGroups">
                        <!-- Groups will be loaded here -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Create Post Modal -->
    <div class="modal-overlay" id="createPostModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Post</h3>
                <button class="close-modal" id="closePostModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <textarea class="form-control" id="modalPostContent" placeholder="What's on your mind?" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label>Add to your post</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" id="addPhotoModalBtn">
                            <i class="fas fa-image"></i> Photo/Video
                        </button>
                        <button class="btn btn-secondary" id="tagFriendsModalBtn">
                            <i class="fas fa-user-tag"></i> Tag Friends
                        </button>
                        <button class="btn btn-secondary" id="addFeelingModalBtn">
                            <i class="fas fa-smile"></i> Feeling
                        </button>
                        <button class="btn btn-secondary" id="addLocationBtn">
                            <i class="fas fa-map-marker-alt"></i> Location
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Privacy</label>
                    <select class="form-control" id="postPrivacy">
                        <option value="friends">üë• Friends</option>
                        <option value="public">üåê Public</option>
                        <option value="only_me">üîí Only me</option>
                    </select>
                </div>
                <div id="postPreview" style="margin-top: 20px; display: none;">
                    <div id="selectedMedia"></div>
                    <div id="taggedFriendsList"></div>
                </div>
                <input type="file" id="mediaUpload" multiple accept="image/*,video/*" style="display: none;">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPostBtn">Cancel</button>
                <button class="btn btn-primary" id="publishPostBtn">Publish</button>
            </div>
        </div>
    </div>

    <!-- Add Story Modal -->
    <div class="modal-overlay" id="addStoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Story</h3>
                <button class="close-modal" id="closeStoryModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div style="border: 2px dashed var(--border-color); border-radius: var(--border-radius); padding: 40px; text-align: center; cursor: pointer;" id="storyUploadArea">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--gray); margin-bottom: 20px;"></i>
                        <p style="color: var(--gray); margin-bottom: 20px;">Click to upload photo or video</p>
                        <p style="font-size: 12px; color: var(--gray);">Stories disappear after 24 hours</p>
                    </div>
                    <input type="file" id="storyUpload" accept="image/*,video/*" style="display: none;">
                </div>
                <div class="form-group">
                    <label>Caption (optional)</label>
                    <textarea class="form-control" id="storyCaption" rows="2" placeholder="Add a caption..."></textarea>
                </div>
                <div id="storyPreview" style="display: none; margin-top: 20px;">
                    <img id="storyPreviewImg" style="width: 100%; border-radius: var(--border-radius);">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelStoryBtn">Cancel</button>
                <button class="btn btn-primary" id="publishStoryBtn" disabled>Publish Story</button>
            </div>
        </div>
    </div>

    <!-- Messenger Modal -->
    <div class="modal-overlay" id="messengerModal">
        <div class="modal-content" style="max-width: 800px; height: 80vh;">
            <div class="chat-container">
                <div class="chat-header">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="user-avatar" style="width: 40px; height: 40px;">
                            <img id="chatAvatar" src="" alt="">
                            <div class="online-dot" id="chatOnlineStatus"></div>
                        </div>
                        <div>
                            <h4 id="chatUserName">Loading...</h4>
                            <small id="chatStatus" style="color: var(--gray); font-size: 12px;">Online</small>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary btn-sm" id="videoCallBtn">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="btn btn-secondary btn-sm" id="voiceCallBtn">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="close-modal" id="closeChatModal">&times;</button>
                    </div>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be loaded here -->
                </div>
                <div class="chat-input">
                    <input type="text" class="form-control" id="chatInput" placeholder="Type a message...">
                    <button class="btn btn-primary" id="sendMessageBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Digital ID Modal -->
    <div class="modal-overlay" id="digitalIdModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Your Digital ID</h3>
                <button class="close-modal" id="closeIdModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="id-card">
                    <h2>FriendsConnect ID</h2>
                    <div class="user-avatar" style="width: 100px; height: 100px; margin: 0 auto 20px;">
                        <img id="idAvatar" src="" alt="">
                        <div class="online-dot" id="idOnlineStatus"></div>
                    </div>
                    <h3 id="idName">Loading...</h3>
                    <p id="idUsername" style="opacity: 0.8; margin-bottom: 20px;">@username</p>
                    <div class="qr-code" id="qrCodeContainer">
                        <!-- QR Code will be generated here -->
                    </div>
                    <p style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
                        Member since: <span id="memberSince">2024</span>
                    </p>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-secondary" id="shareIdBtn">
                            <i class="fas fa-share"></i> Share
                        </button>
                        <button class="btn btn-secondary" id="downloadIdBtn">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Birthday Animation -->
    <div class="birthday-animation" id="birthdayAnimation">
        <div style="text-align: center;">
            <div class="birthday-cake">
                üéÇ
            </div>
            <div class="birthday-text" id="birthdayMessage">
                Happy Birthday!
            </div>
            <button class="btn btn-primary" style="margin-top: 30px;" id="closeBirthdayBtn">
                Send Birthday Wish
            </button>
        </div>
    </div>

    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <button class="theme-btn" id="themeToggle">
            <i class="fas fa-palette"></i>
        </button>
        <div id="themeOptions" style="display: none; position: absolute; bottom: 60px; right: 0; background: var(--card-bg); border-radius: var(--border-radius); padding: 10px; box-shadow: var(--shadow-lg); min-width: 150px;">
            <div style="display: flex; flex-direction: column; gap: 5px;">
                <button class="btn btn-secondary btn-sm" data-theme="light">
                    <i class="fas fa-sun"></i> Light
                </button>
                <button class="btn btn-secondary btn-sm" data-theme="dark">
                    <i class="fas fa-moon"></i> Dark
                </button>
                <button class="btn btn-secondary btn-sm" data-theme="blue">
                    <i class="fas fa-tint" style="color: #1877f2;"></i> Blue
                </button>
                <button class="btn btn-secondary btn-sm" data-theme="purple">
                    <i class="fas fa-tint" style="color: #8a2be2;"></i> Purple
                </button>
                <button class="btn btn-secondary btn-sm" data-theme="gold">
                    <i class="fas fa-crown" style="color: #ffd700;"></i> Gold
                </button>
                <hr style="margin: 5px 0;">
                <div style="display: flex; align-items: center; gap: 10px; padding: 5px;">
                    <label style="font-size: 12px;">Glassmorphism:</label>
                    <input type="checkbox" id="glassmorphismToggle" checked>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; padding: 5px;">
                    <label style="font-size: 12px;">Animations:</label>
                    <input type="checkbox" id="animationsToggle" checked>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div style="padding: 20px;">
            <div class="user-info" style="margin-bottom: 30px;">
                <div class="user-avatar" style="width: 60px; height: 60px; margin: 0 auto 12px;">
                    <img src="" alt="Avatar" id="mobileAvatar">
                </div>
                <h3 style="text-align: center;" id="mobileName">Loading...</h3>
            </div>
            <nav>
                <!-- Same menu items as sidebar -->
            </nav>
        </div>
    </div>

   // Replace the entire script section in your HTML with this:

<script>
        // Global Variables
        let currentUser = null;
        let token = localStorage.getItem('token');
        const API_URL = 'http://localhost:5000/api'; // Updated to match backend
        let socket = null;

        // Initialize App
        document.addEventListener('DOMContentLoaded', async () => {
            // Check for token
            if (!token) {
                // Redirect to login page (you need to create this)
                // window.location.href = '/login.html';
                // For now, we'll show a login modal
                showLoginModal();
                return;
            }
            
            // Verify token and load user data
            const isValid = await verifyToken();
            if (!isValid) {
                localStorage.removeItem('token');
                token = null;
                showLoginModal();
                return;
            }
            
            await loadUserData();
            await loadInitialData();
            setupEventListeners();
            connectWebSocket();
            
            // Check for birthdays
            checkBirthdays();
            
            // Update online status
            updateOnlineStatus();
            
            // Load posts
            loadPosts();
        });

        // Verify Token
        async function verifyToken() {
            try {
                const response = await fetch(`${API_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // Show Login Modal
        function showLoginModal() {
            const modalHTML = `
                <div class="modal-overlay" id="loginModal" style="display: flex;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Login to FriendsConnect</h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" id="loginBtn" style="width: 100%;">Login</button>
                            </div>
                            <div class="form-group">
                                <p style="text-align: center; margin-top: 10px;">
                                    Don't have an account? 
                                    <a href="#" id="showRegister" style="color: var(--primary-light); cursor: pointer;">Register here</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            document.getElementById('loginBtn').addEventListener('click', loginUser);
            document.getElementById('showRegister').addEventListener('click', showRegisterModal);
            
            // Add Enter key support
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') loginUser();
            });
        }

        // Show Register Modal
        function showRegisterModal() {
            document.getElementById('loginModal').remove();
            
            const modalHTML = `
                <div class="modal-overlay" id="registerModal" style="display: flex;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Register for FriendsConnect</h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" class="form-control" id="registerName" placeholder="Enter your full name">
                            </div>
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" class="form-control" id="registerUsername" placeholder="Choose a username">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" class="form-control" id="registerEmail" placeholder="Enter your email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" class="form-control" id="registerPassword" placeholder="Create a password (min. 6 chars)">
                            </div>
                            <div class="form-group">
                                <label>Confirm Password</label>
                                <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm your password">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" id="registerBtn" style="width: 100%;">Register</button>
                            </div>
                            <div class="form-group">
                                <p style="text-align: center; margin-top: 10px;">
                                    Already have an account? 
                                    <a href="#" id="showLogin" style="color: var(--primary-light); cursor: pointer;">Login here</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            document.getElementById('registerBtn').addEventListener('click', registerUser);
            document.getElementById('showLogin').addEventListener('click', () => {
                document.getElementById('registerModal').remove();
                showLoginModal();
            });
        }

        // Login User
        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    token = data.token;
                    localStorage.setItem('token', token);
                    document.getElementById('loginModal').remove();
                    
                    // Reload the page to initialize with logged in user
                    location.reload();
                } else {
                    showNotification('Error', data.message || 'Login failed', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Error', 'Connection error. Please try again.', 'error');
            }
        }

        // Register User
        async function registerUser() {
            const full_name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            // Validation
            if (!full_name || !username || !email || !password || !confirmPassword) {
                showNotification('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Error', 'Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Error', 'Password must be at least 6 characters', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ full_name, username, email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    token = data.token;
                    localStorage.setItem('token', token);
                    document.getElementById('registerModal').remove();
                    
                    // Reload the page to initialize with logged in user
                    location.reload();
                } else {
                    showNotification('Error', data.message || 'Registration failed', 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('Error', 'Connection error. Please try again.', 'error');
            }
        }

        // Load User Data
        async function loadUserData() {
            try {
                const response = await fetch(`${API_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    localStorage.removeItem('token');
                    showLoginModal();
                    return;
                }
                
                const data = await response.json();
                currentUser = data.user;
                
                // Update UI with user data
                updateUserUI();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('Error', 'Failed to load user data', 'error');
                showLoginModal();
            }
        }

        // Update User UI
        function updateUserUI() {
            if (!currentUser) return;
            
            // Update avatar images
            const avatarUrl = currentUser.avatar_url || 'https://via.placeholder.com/150';
            document.getElementById('avatarImg').src = avatarUrl;
            document.getElementById('sidebarAvatar').src = avatarUrl;
            document.getElementById('mobileAvatar').src = avatarUrl;
            document.getElementById('postAvatar').querySelector('img').src = avatarUrl;
            document.getElementById('idAvatar').src = avatarUrl;
            
            // Update names
            document.getElementById('userName').textContent = currentUser.full_name.split(' ')[0];
            document.getElementById('sidebarName').textContent = currentUser.full_name;
            document.getElementById('mobileName').textContent = currentUser.full_name;
            document.getElementById('idName').textContent = currentUser.full_name;
            document.getElementById('idUsername').textContent = `@${currentUser.username}`;
            
            // Update bio
            if (currentUser.bio) {
                document.getElementById('sidebarBio').textContent = currentUser.bio;
            }
            
            // Update member since
            const memberSince = new Date(currentUser.created_at).getFullYear();
            document.getElementById('memberSince').textContent = memberSince;
            
            // Update online status
            const onlineStatus = currentUser.online_status === 'online';
            document.getElementById('onlineStatus').style.display = onlineStatus ? 'block' : 'none';
            document.getElementById('sidebarOnlineStatus').style.display = onlineStatus ? 'block' : 'none';
            document.getElementById('idOnlineStatus').style.display = onlineStatus ? 'block' : 'none';
            
            if (onlineStatus) {
                document.getElementById('onlineStatus').classList.remove('away');
                document.getElementById('sidebarOnlineStatus').classList.remove('away');
                document.getElementById('idOnlineStatus').classList.remove('away');
            }
        }

        // Load Initial Data
        async function loadInitialData() {
            await Promise.all([
                loadFriendSuggestions(),
                loadOnlineFriends(),
                loadBirthdays(),
                loadTrendingPosts(),
                loadMarketplaceItems(),
                loadSuggestedGroups()
            ]);
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Post creation
            document.getElementById('postContent').addEventListener('click', () => {
                showModal('createPostModal');
            });
            
            document.getElementById('postBtn').addEventListener('click', () => {
                showModal('createPostModal');
            });
            
            document.getElementById('publishPostBtn').addEventListener('click', createPost);
            
            // Story creation
            document.getElementById('addStoryBtn').addEventListener('click', () => {
                showModal('addStoryModal');
            });
            
            document.getElementById('storyUploadArea').addEventListener('click', () => {
                document.getElementById('storyUpload').click();
            });
            
            document.getElementById('storyUpload').addEventListener('change', handleStoryUpload);
            document.getElementById('publishStoryBtn').addEventListener('click', publishStory);
            
            // Digital ID
            document.getElementById('digitalIdBtn').addEventListener('click', () => {
                showModal('digitalIdModal');
                generateQRCode();
            });
            
            // Theme switching
            document.getElementById('themeToggle').addEventListener('click', () => {
                const options = document.getElementById('themeOptions');
                options.style.display = options.style.display === 'none' ? 'block' : 'none';
            });
            
            document.querySelectorAll('[data-theme]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.getAttribute('data-theme');
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                    document.getElementById('themeOptions').style.display = 'none';
                });
            });
            
            // Glassmorphism toggle
            document.getElementById('glassmorphismToggle').addEventListener('change', (e) => {
                if (e.target.checked) {
                    document.querySelector('.header').classList.add('glassmorphism');
                } else {
                    document.querySelector('.header').classList.remove('glassmorphism');
                }
                localStorage.setItem('glassmorphism', e.target.checked);
            });
            
            // Animations toggle
            document.getElementById('animationsToggle').addEventListener('change', (e) => {
                document.body.style.animation = e.target.checked ? 'fadeIn 0.3s ease' : 'none';
                localStorage.setItem('animations', e.target.checked);
            });
            
            // Load saved settings
            loadSettings();
            
            // Modal close buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    hideAllModals();
                });
            });
            
            // Overlay click to close
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        hideAllModals();
                    }
                });
            });
            
            // Friend suggestions
            document.getElementById('viewAllSuggestionsBtn').addEventListener('click', loadAllSuggestions);
            
            // Marketplace
            document.getElementById('viewMarketplaceBtn').addEventListener('click', () => {
                showNotification('Marketplace', 'Opening marketplace...', 'info');
            });
            
            // Search
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
            
            // Navigation
            document.getElementById('homeBtn').addEventListener('click', () => {
                document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
                document.getElementById('newsFeedBtn').classList.add('active');
                loadPosts();
            });
            
            document.getElementById('friendsBtn').addEventListener('click', () => {
                showNotification('Friends', 'Loading friends list...', 'info');
            });
            
            document.getElementById('messagesBtn').addEventListener('click', () => {
                showModal('messengerModal');
                loadChats();
            });
            
            document.getElementById('notificationsBtn').addEventListener('click', () => {
                loadNotifications();
                showNotification('Notifications', 'Loading notifications...', 'info');
            });
            
            // User menu
            document.getElementById('userMenu').addEventListener('click', () => {
                showNotification('Profile', 'Opening profile menu...', 'info');
            });
            
            document.getElementById('viewProfileBtn').addEventListener('click', () => {
                window.location.href = `/profile.html?id=${currentUser.id}`;
            });
            
            // Logout functionality
            const logoutBtn = document.createElement('button');
            logoutBtn.textContent = 'Logout';
            logoutBtn.style.cssText = `
                background: var(--accent);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: var(--border-radius);
                cursor: pointer;
                margin-top: 10px;
                width: 100%;
            `;
            logoutBtn.addEventListener('click', logoutUser);
            document.querySelector('.user-info').appendChild(logoutBtn);
            
            // Birthday animation close
            document.getElementById('closeBirthdayBtn').addEventListener('click', () => {
                hideModal('birthdayAnimation');
                showModal('createPostModal');
                document.getElementById('modalPostContent').value = 'Happy Birthday! üéÇüéâ';
            });
            
            // Chat
            document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Share ID
            document.getElementById('shareIdBtn').addEventListener('click', shareDigitalID);
            
            // Download ID
            document.getElementById('downloadIdBtn').addEventListener('click', downloadDigitalID);
            
            // Profile update
            document.getElementById('sidebarBio').addEventListener('click', () => {
                const newBio = prompt('Enter new bio:', currentUser.bio || '');
                if (newBio !== null) {
                    updateBio(newBio);
                }
            });
        }

        // Modal Functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function hideAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.style.display = 'none';
            });
            document.body.style.overflow = 'auto';
        }

        // Load Settings
        function loadSettings() {
            const theme = localStorage.getItem('theme') || 'light';
            const glassmorphism = localStorage.getItem('glassmorphism') !== 'false';
            const animations = localStorage.getItem('animations') !== 'false';
            
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('glassmorphismToggle').checked = glassmorphism;
            document.getElementById('animationsToggle').checked = animations;
            
            if (glassmorphism) {
                document.querySelector('.header').classList.add('glassmorphism');
            }
        }

        // Notification System
        function showNotification(title, message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--card-bg);
                color: var(--text-color);
                padding: 16px;
                border-radius: var(--border-radius);
                box-shadow: var(--shadow-lg);
                z-index: 3000;
                animation: fadeIn 0.3s ease;
                border-left: 4px solid ${type === 'error' ? 'var(--accent)' : type === 'success' ? 'var(--success)' : 'var(--primary-light)'};
                max-width: 400px;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}" 
                       style="color: ${type === 'error' ? 'var(--accent)' : type === 'success' ? 'var(--success)' : 'var(--primary-light)};"></i>
                    <div>
                        <h4 style="font-size: 14px; margin-bottom: 4px;">${title}</h4>
                        <p style="font-size: 13px; color: var(--gray);">${message}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Load Friend Suggestions
        async function loadFriendSuggestions() {
            try {
                const response = await fetch(`${API_URL}/friends/suggestions`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) throw new Error('Failed to load suggestions');
                
                const data = await response.json();
                const container = document.getElementById('friendSuggestions');
                container.innerHTML = '';
                
                data.suggestions.slice(0, 3).forEach(suggestion => {
                    const div = document.createElement('div');
                    div.className = 'friend-suggestion';
                    div.innerHTML = `
                        <div class="user-avatar" style="width: 40px; height: 40px;">
                            <img src="${suggestion.avatar_url || 'https://via.placeholder.com/150'}" alt="">
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${suggestion.full_name}</div>
                            <div class="friend-mutual">${suggestion.mutual_friends_count || 0} mutual friends</div>
                            <div class="friend-actions">
                                <button class="btn btn-success btn-sm" onclick="sendFriendRequest('${suggestion._id}')">
                                    <i class="fas fa-user-plus"></i> Add
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="removeSuggestion('${suggestion._id}')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading suggestions:', error);
            }
        }

        // Send Friend Request
        async function sendFriendRequest(friendId) {
            try {
                const response = await fetch(`${API_URL}/friends/request`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ friendId })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Success', 'Friend request sent!', 'success');
                    loadFriendSuggestions();
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error sending friend request:', error);
                showNotification('Error', error.message || 'Failed to send friend request', 'error');
            }
        }

        // Load Online Friends
        async function loadOnlineFriends() {
            try {
                const response = await fetch(`${API_URL}/friends/online`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) throw new Error('Failed to load online friends');
                
                const data = await response.json();
                const container = document.getElementById('onlineFriendsList');
                container.innerHTML = '';
                
                data.friends.forEach(friend => {
                    const div = document.createElement('div');
                    div.className = 'friend-suggestion';
                    div.innerHTML = `
                        <div class="user-avatar" style="width: 40px; height: 40px;">
                            <img src="${friend.avatar_url || 'https://via.placeholder.com/150'}" alt="">
                            <div class="online-dot"></div>
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.full_name}</div>
                            <div class="friend-mutual" style="color: var(--success);">
                                <i class="fas fa-circle" style="font-size: 8px;"></i> Online now
                            </div>
                            <div class="friend-actions">
                                <button class="btn btn-primary btn-sm" onclick="startChat('${friend._id}')">
                                    <i class="fas fa-comment"></i>
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="callFriend('${friend._id}')">
                                    <i class="fas fa-phone"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading online friends:', error);
            }
        }

        // Load Birthdays
        async function loadBirthdays() {
            try {
                // This is a simplified version - you'll need to implement the backend endpoint
                const birthdays = [
                    { id: 1, full_name: 'John Doe', avatar_url: '', days_until: 0 },
                    { id: 2, full_name: 'Jane Smith', avatar_url: '', days_until: 3 }
                ];
                
                const container = document.getElementById('birthdaysList');
                const section = document.getElementById('birthdaysSection');
                
                if (birthdays.length > 0) {
                    section.style.display = 'block';
                    container.innerHTML = '';
                    
                    birthdays.forEach(birthday => {
                        const div = document.createElement('div');
                        div.className = 'friend-suggestion';
                        div.innerHTML = `
                            <div class="user-avatar" style="width: 40px; height: 40px;">
                                <img src="${birthday.avatar_url || 'https://via.placeholder.com/150'}" alt="">
                                <div class="online-dot" style="background-color: var(--warning);"></div>
                            </div>
                            <div class="friend-info">
                                <div class="friend-name">${birthday.full_name}</div>
                                <div class="friend-mutual">
                                    ${birthday.days_until === 0 ? 'üéÇ Today!' : `In ${birthday.days_until} days`}
                                </div>
                                <div class="friend-actions">
                                    <button class="btn btn-primary btn-sm" onclick="sendBirthdayWish('${birthday.id}')">
                                        <i class="fas fa-birthday-cake"></i> Wish
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(div);
                    });
                } else {
                    section.style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading birthdays:', error);
            }
        }

        // Check Birthdays
        function checkBirthdays() {
            const today = new Date();
            const birthdays = JSON.parse(localStorage.getItem('birthdays') || '[]');
            
            birthdays.forEach(birthday => {
                if (birthday.month === today.getMonth() + 1 && birthday.day === today.getDate()) {
                    showBirthdayAnimation(birthday.name);
                }
            });
        }

        // Show Birthday Animation
        function showBirthdayAnimation(name) {
            document.getElementById('birthdayMessage').textContent = `Happy Birthday, ${name}! üéâ`;
            showModal('birthdayAnimation');
        }

        // Load Trending Posts
        async function loadTrendingPosts() {
            try {
                const response = await fetch(`${API_URL}/posts/trending`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const container = document.getElementById('trendingPosts');
                    container.innerHTML = '';
                    
                    data.posts.slice(0, 3).forEach(post => {
                        const div = document.createElement('div');
                        div.className = 'friend-suggestion';
                        div.innerHTML = `
                            <div style="width: 100%;">
                                <div style="font-weight: 500; margin-bottom: 4px;">${post.content?.substring(0, 50) || 'No content'}...</div>
                                <div style="font-size: 12px; color: var(--gray);">
                                    <i class="fas fa-fire" style="color: var(--warning);"></i>
                                    ${post.like_count || 0} likes ‚Ä¢ ${post.comment_count || 0} comments
                                </div>
                            </div>
                        `;
                        container.appendChild(div);
                    });
                }
            } catch (error) {
                console.error('Error loading trending posts:', error);
            }
        }

        // Load Marketplace Items
        async function loadMarketplaceItems() {
            try {
                // This is a simplified version - you'll need to implement the backend endpoint
                const items = [
                    { id: 1, title: 'iPhone 12', price: 500, media_urls: [] },
                    { id: 2, title: 'MacBook Pro', price: 1200, media_urls: [] }
                ];
                
                const container = document.getElementById('marketplaceItems');
                container.innerHTML = '';
                
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'friend-suggestion';
                    div.innerHTML = `
                        <div style="width: 40px; height: 40px; border-radius: var(--border-radius); overflow: hidden;">
                            <img src="${item.media_urls?.[0] || 'https://via.placeholder.com/150'}" 
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${item.title}</div>
                            <div class="friend-mutual">$${item.price}</div>
                            <div class="friend-actions">
                                <button class="btn btn-primary btn-sm" onclick="viewItem(${item.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading marketplace items:', error);
            }
        }

        // Load Suggested Groups
        async function loadSuggestedGroups() {
            try {
                // This is a simplified version - you'll need to implement the backend endpoint
                const groups = [
                    { id: 1, name: 'Tech Enthusiasts', avatar_url: '', member_count: 1250 },
                    { id: 2, name: 'Travel Buddies', avatar_url: '', member_count: 850 }
                ];
                
                const container = document.getElementById('suggestedGroups');
                container.innerHTML = '';
                
                groups.forEach(group => {
                    const div = document.createElement('div');
                    div.className = 'friend-suggestion';
                    div.innerHTML = `
                        <div style="width: 40px; height: 40px; border-radius: var(--border-radius); overflow: hidden;">
                            <img src="${group.avatar_url || 'https://via.placeholder.com/150'}" 
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${group.name}</div>
                            <div class="friend-mutual">${group.member_count} members</div>
                            <div class="friend-actions">
                                <button class="btn btn-success btn-sm" onclick="joinGroup('${group.id}')">
                                    Join
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading suggested groups:', error);
            }
        }

        // Load Posts
        async function loadPosts() {
            try {
                const response = await fetch(`${API_URL}/posts/feed`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) throw new Error('Failed to load posts');
                
                const data = await response.json();
                const container = document.getElementById('postsFeed');
                container.innerHTML = '';
                
                data.posts.forEach(post => {
                    const postElement = createPostElement(post);
                    container.appendChild(postElement);
                });
                
            } catch (error) {
                console.error('Error loading posts:', error);
                showNotification('Error', 'Failed to load posts', 'error');
            }
        }

        // Create Post Element
        function createPostElement(post) {
            const div = document.createElement('div');
            div.className = 'post-card animate-fade-in';
            div.dataset.postId = post._id;
            
            const timeAgo = getTimeAgo(post.createdAt);
            const privacyIcon = post.privacy === 'public' ? 'üåê' : 
                               post.privacy === 'friends' ? 'üë•' : 'üîí';
            
            let mediaHtml = '';
            if (post.media_urls && post.media_urls.length > 0) {
                if (post.media_urls[0].includes('video')) {
                    mediaHtml = `
                        <div class="post-media">
                            <video controls style="width: 100%; border-radius: var(--border-radius);">
                                <source src="${post.media_urls[0]}" type="video/mp4">
                            </video>
                        </div>
                    `;
                } else {
                    mediaHtml = `
                        <div class="post-media">
                            <img src="${post.media_urls[0]}" alt="Post image" 
                                 style="width: 100%; border-radius: var(--border-radius);">
                        </div>
                    `;
                }
            }
            
            div.innerHTML = `
                <div class="post-header">
                    <div class="user-avatar" style="width: 40px; height: 40px;">
                        <img src="${post.author?.avatar_url || 'https://via.placeholder.com/150'}" alt="">
                    </div>
                    <div class="post-author-info">
                        <div class="post-author-name">${post.author?.full_name || 'Unknown User'}</div>
                        <div class="post-meta">
                            <span>${timeAgo}</span>
                            <span>‚Ä¢</span>
                            <span>${privacyIcon}</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-sm">
                        <i class="fas fa-ellipsis-h"></i>
                    </button>
                </div>
                <div class="post-content">
                    ${post.content || ''}
                </div>
                ${mediaHtml}
                <div class="post-stats">
                    <span class="likes-count">${post.likeCount || 0} likes</span>
                    <span class="comments-count">${post.commentCount || 0} comments</span>
                    <span class="shares-count">${post.shareCount || 0} shares</span>
                </div>
                <div class="post-actions-bar">
                    <button class="post-action-btn ${post.liked ? 'active' : ''}" onclick="likePost('${post._id}')">
                        <i class="fas fa-thumbs-up"></i> Like
                    </button>
                    <button class="post-action-btn" onclick="focusComment('${post._id}')">
                        <i class="fas fa-comment"></i> Comment
                    </button>
                    <button class="post-action-btn" onclick="sharePost('${post._id}')">
                        <i class="fas fa-share"></i> Share
                    </button>
                    <button class="post-action-btn" onclick="savePost('${post._id}')">
                        <i class="fas fa-bookmark"></i> Save
                    </button>
                </div>
                <div class="comments-section" id="comments-${post._id}">
                    <div class="comment-input">
                        <div class="user-avatar" style="width: 32px; height: 32px;">
                            <img src="${currentUser?.avatar_url || 'https://via.placeholder.com/150'}" alt="">
                        </div>
                        <input type="text" id="comment-input-${post._id}" placeholder="Write a comment..." 
                               onkeypress="if(event.key === 'Enter') addComment('${post._id}')">
                        <button class="btn btn-primary btn-sm" onclick="addComment('${post._id}')">Post</button>
                    </div>
                </div>
            `;
            
            return div;
        }

        // Create Post
        async function createPost() {
            const content = document.getElementById('modalPostContent').value;
            const privacy = document.getElementById('postPrivacy').value;
            
            if (!content.trim()) {
                showNotification('Error', 'Please write something to post', 'error');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('content', content);
                formData.append('privacy', privacy);
                
                // Handle file uploads
                const fileInput = document.getElementById('mediaUpload');
                if (fileInput.files.length > 0) {
                    for (let i = 0; i < fileInput.files.length; i++) {
                        formData.append('post_media', fileInput.files[i]);
                    }
                }
                
                const response = await fetch(`${API_URL}/posts`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Success', 'Post published successfully!', 'success');
                    hideModal('createPostModal');
                    document.getElementById('modalPostContent').value = '';
                    document.getElementById('selectedMedia').innerHTML = '';
                    document.getElementById('taggedFriendsList').innerHTML = '';
                    loadPosts();
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error creating post:', error);
                showNotification('Error', error.message || 'Failed to create post', 'error');
            }
        }

        // Like Post
        async function likePost(postId) {
            try {
                const response = await fetch(`${API_URL}/posts/${postId}/like`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const likeBtn = document.querySelector(`.post-card[data-post-id="${postId}"] .post-action-btn`);
                    const likesCount = document.querySelector(`.post-card[data-post-id="${postId}"] .likes-count`);
                    
                    if (data.liked) {
                        likeBtn.classList.add('active');
                        likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i> Liked';
                        showNotification('Success', 'Post liked!', 'success');
                    } else {
                        likeBtn.classList.remove('active');
                        likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i> Like';
                    }
                    
                    // Update likes count
                    if (likesCount) {
                        const currentLikes = parseInt(likesCount.textContent) || 0;
                        likesCount.textContent = `${data.liked ? currentLikes + 1 : currentLikes - 1} likes`;
                    }
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error liking post:', error);
                showNotification('Error', error.message || 'Failed to like post', 'error');
            }
        }

        // Add Comment
        async function addComment(postId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            const comment = commentInput.value.trim();
            
            if (!comment) {
                showNotification('Error', 'Please write a comment', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/posts/${postId}/comments`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: comment })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    commentInput.value = '';
                    
                    // Add comment to UI
                    const commentsSection = document.getElementById(`comments-${postId}`);
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'comment animate-fade-in';
                    commentDiv.innerHTML = `
                        <div class="user-avatar" style="width: 32px; height: 32px;">
                            <img src="${currentUser?.avatar_url || 'https://via.placeholder.com/150'}" alt="">
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500; font-size: 13px;">${currentUser?.full_name || 'You'}</div>
                            <div style="font-size: 14px; margin-top: 4px;">${comment}</div>
                            <div style="font-size: 12px; color: var(--gray); margin-top: 4px;">
                                <span style="cursor: pointer;" onclick="likeComment('${data.comment._id}')">Like</span>
                                <span style="margin: 0 8px;">‚Ä¢</span>
                                <span style="cursor: pointer;">Reply</span>
                            </div>
                        </div>
                    `;
                    
                    commentsSection.insertBefore(commentDiv, commentsSection.firstChild);
                    
                    // Update comment count
                    const commentsCount = document.querySelector(`.post-card[data-post-id="${postId}"] .comments-count`);
                    if (commentsCount) {
                        const currentComments = parseInt(commentsCount.textContent) || 0;
                        commentsCount.textContent = `${currentComments + 1} comments`;
                    }
                    
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error adding comment:', error);
                showNotification('Error', error.message || 'Failed to add comment', 'error');
            }
        }

        // Focus Comment
        function focusComment(postId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            if (commentInput) {
                commentInput.focus();
            }
        }

        // Share Post
        async function sharePost(postId) {
            try {
                const response = await fetch(`${API_URL}/posts/${postId}/share`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: 'Shared this post' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Success', 'Post shared successfully!', 'success');
                    
                    // Update share count
                    const sharesCount = document.querySelector(`.post-card[data-post-id="${postId}"] .shares-count`);
                    if (sharesCount) {
                        const currentShares = parseInt(sharesCount.textContent) || 0;
                        sharesCount.textContent = `${currentShares + 1} shares`;
                    }
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error sharing post:', error);
                showNotification('Error', error.message || 'Failed to share post', 'error');
            }
        }

        // Handle Story Upload
        function handleStoryUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const preview = document.getElementById('storyPreview');
            const previewImg = document.getElementById('storyPreviewImg');
            const publishBtn = document.getElementById('publishStoryBtn');
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                    publishBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                // Handle video preview
                const video = document.createElement('video');
                video.src = URL.createObjectURL(file);
                video.controls = true;
                video.style.width = '100%';
                video.style.borderRadius = 'var(--border-radius)';
                
                preview.innerHTML = '';
                preview.appendChild(video);
                preview.style.display = 'block';
                publishBtn.disabled = false;
            }
        }

        // Publish Story
        async function publishStory() {
            const caption = document.getElementById('storyCaption').value;
            const fileInput = document.getElementById('storyUpload');
            
            if (!fileInput.files[0]) {
                showNotification('Error', 'Please select a photo or video', 'error');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('story_media', fileInput.files[0]);
                if (caption) formData.append('caption', caption);
                
                const response = await fetch(`${API_URL}/stories`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Success', 'Story published! It will disappear in 24 hours.', 'success');
                    hideModal('addStoryModal');
                    
                    // Reset form
                    document.getElementById('storyCaption').value = '';
                    document.getElementById('storyPreview').style.display = 'none';
                    document.getElementById('publishStoryBtn').disabled = true;
                    fileInput.value = '';
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error publishing story:', error);
                showNotification('Error', error.message || 'Failed to publish story', 'error');
            }
        }

        // Generate QR Code
        function generateQRCode() {
            const container = document.getElementById('qrCodeContainer');
            if (!currentUser) return;
            
            // Create a simple QR code visualization
            const qrSize = 150;
            const canvas = document.createElement('canvas');
            canvas.width = qrSize;
            canvas.height = qrSize;
            const ctx = canvas.getContext('2d');
            
            // Generate random QR pattern (for demo purposes)
            const data = `friendsconnect://user/${currentUser._id}`;
            const modules = 21;
            const moduleSize = qrSize / modules;
            
            // Draw background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, qrSize, qrSize);
            
            // Draw QR pattern
            ctx.fillStyle = 'black';
            for (let y = 0; y < modules; y++) {
                for (let x = 0; x < modules; x++) {
                    // Simple pattern generation (not real QR)
                    const value = Math.sin(x * y + x + y) > 0.5;
                    if (value) {
                        ctx.fillRect(x * moduleSize, y * moduleSize, moduleSize, moduleSize);
                    }
                }
            }
            
            // Add logo in center
            ctx.fillStyle = 'white';
            ctx.fillRect((modules/2 - 2) * moduleSize, (modules/2 - 2) * moduleSize, 5 * moduleSize, 5 * moduleSize);
            
            // Draw FC logo
            ctx.fillStyle = 'black';
            ctx.font = `${moduleSize * 3}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('FC', qrSize/2, qrSize/2);
            
            container.innerHTML = '';
            container.appendChild(canvas);
        }

        // Share Digital ID
        async function shareDigitalID() {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'My FriendsConnect Digital ID',
                        text: `Connect with me on FriendsConnect! My username is @${currentUser.username}`,
                        url: `https://friendsconnect.com/user/${currentUser._id}`
                    });
                    showNotification('Success', 'Digital ID shared!', 'success');
                } catch (error) {
                    console.error('Error sharing:', error);
                    showNotification('Info', 'Sharing cancelled', 'info');
                }
            } else {
                // Fallback: copy to clipboard
                const shareText = `Connect with me on FriendsConnect!\nUsername: @${currentUser.username}\nProfile: https://friendsconnect.com/user/${currentUser._id}`;
                navigator.clipboard.writeText(shareText)
                    .then(() => showNotification('Success', 'Link copied to clipboard!', 'success'))
                    .catch(() => showNotification('Error', 'Failed to copy link', 'error'));
            }
        }

        // Download Digital ID
        function downloadDigitalID() {
            const container = document.getElementById('qrCodeContainer');
            const canvas = container.querySelector('canvas');
            
            if (!canvas) return;
            
            const link = document.createElement('a');
            link.download = `friendsconnect-id-${currentUser.username}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            showNotification('Success', 'Digital ID downloaded!', 'success');
        }

        // Connect WebSocket
        function connectWebSocket() {
            try {
                // Initialize Socket.io
                socket = io('http://localhost:5000');
                
                // Join user's room
                socket.emit('join-user', currentUser._id);
                
                // Listen for messages
                socket.on('receive-message', (data) => {
                    showNotification('New Message', `Message from ${data.senderId}`, 'info');
                });
                
                socket.on('friend-online', (userId) => {
                    showNotification('Friend Online', 'A friend is now online', 'info');
                });
                
                console.log('WebSocket connected successfully');
                
            } catch (error) {
                console.error('WebSocket connection error:', error);
            }
        }

        // Update Online Status
        async function updateOnlineStatus() {
            try {
                const response = await fetch(`${API_URL}/users/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'online' })
                });
                
                if (response.ok) {
                    // Update UI
                    document.getElementById('onlineStatus').style.display = 'block';
                    document.getElementById('sidebarOnlineStatus').style.display = 'block';
                    document.getElementById('idOnlineStatus').style.display = 'block';
                }
                
            } catch (error) {
                console.error('Error updating online status:', error);
            }
        }

        // Perform Search
        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            try {
                const response = await fetch(`${API_URL}/users/search?q=${encodeURIComponent(query)}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Show search results in modal
                    const modalContent = `
                        <div style="max-height: 400px; overflow-y: auto;">
                            <h3 style="margin-bottom: 16px;">Search Results for "${query}"</h3>
                            ${data.users && data.users.length > 0 ? `
                                <h4 style="margin-bottom: 12px;">People</h4>
                                ${data.users.map(user => `
                                    <div class="friend-suggestion" style="margin-bottom: 8px;">
                                        <div class="user-avatar" style="width: 40px; height: 40px;">
                                            <img src="${user.avatar_url || 'https://via.placeholder.com/150'}" alt="">
                                        </div>
                                        <div class="friend-info">
                                            <div class="friend-name">${user.full_name}</div>
                                            <div class="friend-mutual">${user.mutual_friends || 0} mutual friends</div>
                                        </div>
                                        <div class="friend-actions">
                                            <button class="btn btn-primary btn-sm" onclick="sendFriendRequest('${user._id}')">
                                                Add Friend
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            ` : `
                                <div style="text-align: center; padding: 40px; color: var(--gray);">
                                    <i class="fas fa-search" style="font-size: 48px; margin-bottom: 16px;"></i>
                                    <p>No results found for "${query}"</p>
                                </div>
                            `}
                        </div>
                    `;
                    
                    showCustomModal('Search Results', modalContent);
                }
            } catch (error) {
                console.error('Error performing search:', error);
                showNotification('Error', 'Search failed', 'error');
            }
        }

        // Show Custom Modal
        function showCustomModal(title, content) {
            const modalId = 'customModal';
            let modal = document.getElementById(modalId);
            
            if (!modal) {
                modal = document.createElement('div');
                modal.id = modalId;
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>${title}</h3>
                            <button class="close-modal" onclick="hideModal('${modalId}')">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } else {
                modal.querySelector('.modal-header h3').textContent = title;
                modal.querySelector('.modal-body').innerHTML = content;
            }
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Load Notifications
        async function loadNotifications() {
            try {
                const response = await fetch(`${API_URL}/notifications`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const notifications = data.notifications || [];
                    
                    const notificationContent = `
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${notifications.length > 0 ? notifications.map(notif => `
                                <div class="friend-suggestion" style="margin-bottom: 8px;">
                                    <div class="user-avatar" style="width: 40px; height: 40px;">
                                        <img src="${notif.sender_avatar || 'https://via.placeholder.com/150'}" alt="">
                                    </div>
                                    <div class="friend-info">
                                        <div class="friend-name">${notif.sender_name}</div>
                                        <div class="friend-mutual">${notif.message}</div>
                                        <div style="font-size: 11px; color: var(--gray);">${getTimeAgo(notif.created_at)}</div>
                                    </div>
                                    ${notif.type === 'friend_request' ? `
                                        <div class="friend-actions">
                                            <button class="btn btn-success btn-sm" onclick="acceptFriendRequest('${notif.sender_id}')">
                                                Accept
                                            </button>
                                            <button class="btn btn-secondary btn-sm" onclick="declineFriendRequest('${notif.sender_id}')">
                                                Decline
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('') : `
                                <div style="text-align: center; padding: 40px; color: var(--gray);">
                                    <i class="fas fa-bell-slash" style="font-size: 48px; margin-bottom: 16px;"></i>
                                    <p>No notifications yet</p>
                                </div>
                            `}
                        </div>
                    `;
                    
                    showCustomModal('Notifications', notificationContent);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        // Accept Friend Request
        async function acceptFriendRequest(requestId) {
            try {
                const response = await fetch(`${API_URL}/friends/request/${requestId}/accept`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Success', 'Friend request accepted!', 'success');
                    hideModal('customModal');
                    loadNotifications();
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error accepting friend request:', error);
                showNotification('Error', error.message || 'Failed to accept friend request', 'error');
            }
        }

        // Get Time Ago
        function getTimeAgo(timestamp) {
            const now = new Date();
            const past = new Date(timestamp);
            const diff = now - past;
            
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            
            return past.toLocaleDateString();
        }

        // Start Chat
        async function startChat(friendId) {
            showModal('messengerModal');
            
            try {
                const response = await fetch(`${API_URL}/users/${friendId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const user = data.user;
                    
                    document.getElementById('chatUserName').textContent = user.full_name;
                    document.getElementById('chatAvatar').src = user.avatar_url || 'https://via.placeholder.com/150';
                    
                    // Load chat history would go here
                    
                }
            } catch (error) {
                console.error('Error starting chat:', error);
            }
        }

        // Send Message in Chat
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            try {
                // Add message to UI immediately
                const container = document.getElementById('chatMessages');
                const msgDiv = document.createElement('div');
                msgDiv.className = 'message sent animate-fade-in';
                msgDiv.textContent = message;
                container.appendChild(msgDiv);
                container.scrollTop = container.scrollHeight;
                
                // Clear input
                input.value = '';
                
                // Send via WebSocket
                if (socket) {
                    socket.emit('send-message', {
                        receiverId: 'friend_id_here', // You need to track current chat
                        message: message,
                        senderId: currentUser._id
                    });
                }
                
            } catch (error) {
                console.error('Error sending message:', error);
                showNotification('Error', 'Failed to send message', 'error');
            }
        }

        // Logout User
        async function logoutUser() {
            try {
                const response = await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                // Clear local storage
                localStorage.removeItem('token');
                token = null;
                currentUser = null;
                
                // Redirect to login
                location.reload();
                
            } catch (error) {
                console.error('Error logging out:', error);
                localStorage.removeItem('token');
                location.reload();
            }
        }

        // Update Bio
        async function updateBio(newBio) {
            try {
                const formData = new FormData();
                formData.append('bio', newBio);
                
                const response = await fetch(`${API_URL}/auth/profile`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentUser.bio = newBio;
                    document.getElementById('sidebarBio').textContent = newBio;
                    showNotification('Success', 'Bio updated!', 'success');
                } else {
                    throw new Error(data.message);
                }
                
            } catch (error) {
                console.error('Error updating bio:', error);
                showNotification('Error', error.message || 'Failed to update bio', 'error');
            }
        }

        // Add CSS for fadeOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-10px); }
            }
            
            .notification {
                animation: fadeIn 0.3s ease;
            }
        `;
        document.head.appendChild(style);

        // Initialize tooltips
        function initTooltips() {
            const tooltipElements = document.querySelectorAll('[data-tooltip]');
            tooltipElements.forEach(el => {
                el.addEventListener('mouseenter', showTooltip);
                el.addEventListener('mouseleave', hideTooltip);
            });
        }

        function showTooltip(e) {
            const tooltipText = e.target.getAttribute('data-tooltip');
            const tooltip = document.createElement('div');
            tooltip.className = 'custom-tooltip';
            tooltip.textContent = tooltipText;
            tooltip.style.cssText = `
                position: fixed;
                background: var(--dark);
                color: white;
                padding: 6px 12px;
                border-radius: 4px;
                font-size: 12px;
                z-index: 10000;
                pointer-events: none;
                white-space: nowrap;
            `;
            document.body.appendChild(tooltip);
            
            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = `${rect.left + rect.width / 2 - tooltip.offsetWidth / 2}px`;
            tooltip.style.top = `${rect.top - tooltip.offsetHeight - 5}px`;
            
            e.target._currentTooltip = tooltip;
        }

        function hideTooltip(e) {
            if (e.target._currentTooltip) {
                e.target._currentTooltip.remove();
                delete e.target._currentTooltip;
            }
        }

        // Initialize everything
        initTooltips();
                    </script>
</body>
</html>
